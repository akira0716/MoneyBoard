# **利用額集計ツール 要件定義書**

## **1\. 概要**

本ツールは、特定のCSV形式の利用明細データを読み込み、取引をカテゴリー別に分類し、月ごとの利用額を集計・可視化することを目的とします。保守性と拡張性の高いアプリケーション構造として、.NET MAUIとMVVMパターンを採用します。

## **2\. 対象環境・技術スタック**

| 項目 | 詳細 | 備考 |
| :---- | :---- | :---- |
| **開発環境** | .NET MAUI (C\#) | モバイルおよびデスクトップ対応を想定 |
| **デザインパターン** | MVVM (Model-View-ViewModel) | 保守性、テスト容易性の確保 |
| **データベース** | SQLite | ローカルでのデータ永続化 |
| **O/Rマッピング** | Entity Framework Core (EF Core) | データベースアクセス層として使用 |

## **3\. 機能要件**

### **3.1 CSVファイル読み込み機能**

1. **ファイル選択**: ユーザーはファイル選択ダイアログを通じて、集計対象のCSVファイルを指定できること。  
2. **CSV解析**: 指定されたCSVファイルを読み込み、定義されたカラム構造に基づいてデータレコードを抽出できること。  
3. **データインポート**: 読み込んだデータは、重複チェックを行いながらデータベースにインポートされること。

### **3.2 データモデルと永続化**

1. **取引データ (Transaction)**: CSVから読み込んだ個別の取引記録（利用日、利用名、利用金額など）を永続化できること。  
2. **カテゴリーデータ (Category)**: ユーザーが定義するカテゴリー（例：食費、交通費、娯楽）を管理できること。  
3. **マッピングデータ (Mapping)**: 利用名（利用名・商品名）とカテゴリーIDを紐づけるマッピング情報を永続化できること。

### **3.3 カテゴリーマッピング機能**

1. **自動マッピング**: 新しい取引データをインポートする際、既存の「マッピングデータ」を参照し、利用名・商品名に基づいてカテゴリーを自動的に付与すること。  
2. **新規利用名の識別**: データベースに既存のマッピングが存在しない利用名・商品名（新規利用名）を識別し、一覧として保持すること。  
3. **カテゴリー指定UI**:  
   * 新規利用名の一覧をユーザーに提示すること。  
   * ユーザーは、一覧から選択した新規利用名に対し、既存のカテゴリーまたは新規作成するカテゴリーを指定できること。  
   * カテゴリー指定が完了すると、対応する新規マッピングデータが保存され、次回以降のインポートで自動的に引き当てられること。

### **3.4 集計・表示機能**

1. **集計単位**: 月単位（利用日のカラムから抽出）で利用額を集計すること。  
2. **集計結果表示**:  
   * 選択された月（または全期間）について、カテゴリーごとの総利用額を表示すること。  
   * 各カテゴリーの利用額が、その月の（または全期間の）総利用額に対して占める割合（パーセンテージ）を表示すること。  
3. **UI表示**: 集計結果は、グラフやリストなどを用いて「良い感じ」に（視覚的にわかりやすく）表示されること。

## **4\. 非機能要件**

### **4.1 アーキテクチャ**

* **保守性**: アプリケーションはMVVMパターンに従い、ビジネスロジック（ViewModel/Model）とUI（View）を明確に分離すること。  
* **データアクセス**: データアクセスはEF Coreリポジトリパターンを通じて行い、データベースへの直接的な依存を排除すること。

### **4.2 ユーザビリティ**

* **初回起動**: 初回起動時は、カテゴリーがない状態でのデータインポートを可能とし、マッピング機能へ誘導する設計とすること。  
* **応答性**: 大量のCSVデータ（例：数千件）を読み込んでも、UIがフリーズしないよう、非同期処理を適切に使用すること。

## **5\. データ構造定義 (CSV/DB)**

### **5.1 CSVファイル形式**

読み込み対象とするCSVファイルの必須カラムは以下の通りとする。

| カラム名 | データ型 | 必須/任意 | 備考 |
| :---- | :---- | :---- | :---- |
| **利用日** | Date | 必須 | 取引が発生した日付 (例: 2025/09/27) |
| **利用名・商品名** | String | 必須 | カテゴリーマッピングのキーとなる名称 |
| **利用金額** | Integer | 必須 | 実際に利用した金額 |
| 利用者 | String | 任意 |  |
| 支払方法 | String | 任意 |  |
| 支払総額 | Integer | 任意 |  |

### **5.2 データベースエンティティ（EF Core）**

| エンティティ名 | プロパティ（属性） | 説明 |
| :---- | :---- | :---- |
| **Transaction (取引)** | Id, UsageDate, UsageName, Amount, CategoryId (FK) | 個別取引記録 |
| **Category (カテゴリー)** | Id, Name (例: 食費, 交通費) | ユーザー定義の分類 |
| **Mapping (マッピング)** | Id, UsageName (キー), CategoryId (FK) | 利用名とカテゴリーの紐づけ |

